"use strict";angular.module("oisdn4App",["ngResource","ngTouch","ui.bootstrap","ui.router","highcharts-ng","geolocation","ngDialog","uiGmapgoogle-maps"]).config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/"),a.state("home",{url:"/",templateUrl:"views/main.html",controller:"MainCtrl"}).state("account",{url:"/:id/account",templateUrl:"views/account.html",controller:"AccountCtrl"})}]).config(["uiGmapGoogleMapApiProvider",function(a){a.configure({v:"3.17"})}]).run(["$rootScope","users","geolocation","ehrApi","$state",function(a,b,c,d,e){a.uporabniki=b,a.$state=e,a.$on("ngDialog.opened",function(){c.getLocation().then(function(b){a.lokacija={latitude:b.coords.latitude,longitude:b.coords.longitude}})})}]),angular.module("oisdn4App").controller("MainCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("oisdn4App").controller("AccountCtrl",["$scope","grafi","users","$stateParams","ehrApi","$filter",function(a,b,c,d,e,f){a.uporabnik=c[d.id],a.grafi=angular.copy(b),e.getBP(a.uporabnik).then(function(b){angular.forEach(b.data.reverse(),function(b){a.grafi.tlak.series[0].data.push({datum:f("date")(b.time,"dd. MM. yyyy"),x:b.diastolic,y:b.systolic})})})}]),angular.module("oisdn4App").service("ehrApi",["$http","$q","users",function(a,b,c){function d(a,b,c,d,e,f){return{"ctx/language":"en","ctx/territory":"SI","ctx/time":a,"vital_signs/height_length/any_event/body_height_length":b,"vital_signs/body_weight/any_event/body_weight":c,"vital_signs/body_temperature/any_event/temperature|magnitude":d,"vital_signs/body_temperature/any_event/temperature|unit":"°C","vital_signs/blood_pressure/any_event/systolic":e,"vital_signs/blood_pressure/any_event/diastolic":f}}function e(c){var e=[];e.push(a({url:f+"/demographics/party",method:"POST",data:{firstNames:c.ime,lastNames:c.priimek,dateOfBirth:c.datumRojstva,partyAdditionalInfo:[{key:"ehrId",value:c.ehrId}]}}));for(var g=new Date,h=0;h<c.meritve.height.length;h++)g.setFullYear(2014-h),e.push(a({url:f+"/composition",method:"POST",params:{ehrId:c.ehrId,templateId:"Vital Signs",format:"FLAT",committer:"Milka Gorenjka"},data:d(g.toISOString(),c.meritve.height[h],c.meritve.weight[h],c.meritve.temperature[h],c.meritve.systolicBP[h],c.meritve.diastolicBP[h])}));return b.all(e)}var f="https://rest.ehrscape.com/rest/v1",g=b.defer();a({url:f+"/session",method:"POST",params:{username:"ois.seminar",password:"ois4fri"}}).success(function(a){g.resolve(a.sessionId)}),this.getBP=function(c){var d=b.defer();return g.promise.then(function(b){a.defaults.headers.common["Ehr-Session"]=b,a({url:f+"/view/"+c.ehrId+"/blood_pressure",method:"GET"}).then(function(a){d.resolve(a)})}),d.promise},this.generateUsers=function(){var d=[];g.promise.then(function(g){a.defaults.headers.common["Ehr-Session"]=g,angular.forEach(c,function(b){d.push(a({url:f+"/ehr",method:"POST"}).success(function(a){console.log(a.ehrId),b.ehrId=a.ehrId}))}),b.all(d).then(function(){angular.forEach(c,function(a){d.push(e(a))}),b.all(d).then(function(){console.log("All dunn!")})})})}}]),angular.module("oisdn4App").constant("users",[{ime:"Ferdo",priimek:"Sidonija",slika:"images/franklin.9ab12c7a.png",datumRojstva:"1955-10-28T00:00",ehrId:"2a3148d9-5801-48cf-bc76-fa0fc6e8ae9c",meritve:{temperature:[36.8,37,36.5,38.2,37.3],systolicBP:[106,117,115,102,119],diastolicBP:[65,61,68,71,69],height:[185,186,186,185,186],weight:[77.5,78.3,79,80,83.2]}},{ime:"Mojmir",priimek:"Vekoslav",slika:"images/obama.4072de07.png",datumRojstva:"1986-11-21T00:00",ehrId:"cdd64978-016c-4ec2-9a87-3c35be22e46f",meritve:{temperature:[37.2,37.5,37,36.8,36.9],systolicBP:[129,135,139,130,132],diastolicBP:[75,90,78,89,85],height:[177,176,178,177,175],weight:[64,65.7,65.1,66.2,65.9]}},{ime:"Bogomil",priimek:"Borka",slika:"images/lincoln.e8c9bbfc.png",datumRojstva:"1994-12-10T00:00",ehrId:"1fd6482f-955f-4f8d-b0a9-b3086f7bdb58",meritve:{temperature:[36.7,36.9,37.1,36.8,37.4],systolicBP:[141,135,147,150,142],diastolicBP:[79,89,91,92,87],height:[182,181,183,185,184],weight:[71.3,72.4,71.9,73,73.2]}}]),angular.module("oisdn4App").constant("grafi",{tlak:{options:{chart:{type:"scatter",zoomType:"xy"},plotOptions:{scatter:{tooltip:{headerFormat:"<b>Krvni tlak</b><br>",pointFormat:"<b>Sistolični:</b> {point.x} mm Hg<br> <b>Diastolični:</b> {point.y} mm Hg <br> <b>Datum: </b> {point.datum}"}}},xAxis:{min:40,max:100,title:{text:"Diastolični"},plotBands:[{color:"#dff0d8",from:60,to:80,zIndex:-19},{color:"#fcf8e3",from:80,to:90,zIndex:-17},{color:"#f2dede",from:90,to:100,zIndex:-15}]},yAxis:{title:{text:"Sistolični"},min:70,max:190,tickInterval:10,plotBands:[{color:"#d9edf7",from:70,to:90,zIndex:-20},{color:"#dff0d8",from:90,to:120,zIndex:-18},{color:"#fcf8e3",from:120,to:140,zIndex:-16},{color:"#f2dede",from:140,to:190,zIndex:-14}]}},series:[{name:"Krvni tlak",data:[],color:"#333"}],title:{text:null}}});